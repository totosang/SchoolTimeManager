<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=1000"><title>School Time Manager 0.1 (GitHub Edition)</title><style>@import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&family=Quicksand:wght@600&display=swap');body{font-family:'Kanit','Quicksand',sans-serif;background:linear-gradient(135deg,#ffd6fd 0%,#cbf6ff 100%);margin:0;padding:0;min-height:100vh;text-align:center}.container{max-width:1000px;margin:38px auto 0 auto;padding:28px 18px 18px 18px;background:rgba(255,255,255,0.97);border-radius:32px;box-shadow:0 12px 36px rgba(85,197,122,0.07),0 3px 11px rgba(202,76,212,0.08)}.app-header{display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:12px}.main-title{font-family:'Quicksand','Kanit',sans-serif;font-size:2.08rem;color:#ea3397;letter-spacing:2px;padding:0 16px 0 0;background:linear-gradient(90deg,#e1ffe8 0 40%,#fff0f7 60% 100%);border-radius:18px;font-weight:bold;line-height:1.2;display:flex;align-items:center;gap:13px;box-shadow:0 1px 12px #f5dbfd66}.main-title .logo-emoji{font-size:2.25rem;filter:drop-shadow(1px 2px 7px #ec9cf959)}.form-row-btns{display:flex;justify-content:flex-start;align-items:center;gap:9px;margin-bottom:8px;width:100%}.form-row-btns .file-btns{display:flex;gap:9px}.form-row-btns button{font-family:'Kanit','Quicksand',sans-serif;font-size:1.01rem;border-radius:8px;border:none;background:linear-gradient(90deg,#e1ffe8 40%,#fff0f7 100%);color:#565874;padding:7px 17px;box-shadow:0 2px 7px #ecedfd19;cursor:pointer;transition:background .17s,box-shadow .14s;font-weight:bold;outline:none}.form-row-btns button:hover{background:linear-gradient(90deg,#c1fee1 40%,#ffc3f0 100%);color:#ea3397;box-shadow:0 2px 12px #ffe0fb49}.form-row-btns input[type="file"]{display:none}.form-section input[type="text"]{min-width:110px;max-width:200px;padding:7px 11px;border-radius:8px;border:1.3px solid #b7edcf;background:#fafffc;font-size:1.01rem;box-shadow:0 1px 4px #e2ffef28;outline:none;transition:border 0.22s,background 0.19s;margin:0 3px}.form-section input[type="text"]:focus{border:2px solid #ff99ba;background:#fffafd}#videoUrl{width:170px}#videoName{width:140px}#startTime,#endTime{width:90px}#addButton{background:linear-gradient(90deg,#a0ffcb 5%,#ffe0ff 80%);color:#92547e;border:none;border-radius:11px;padding:9px 22px;font-size:1.04rem;font-family:'Kanit','Quicksand',sans-serif;cursor:pointer;box-shadow:0 2px 9px #d9ffe6a8;font-weight:bold;margin-left:5px;transition:background .18s,box-shadow .18s;min-width:130px}#addButton:hover{background:linear-gradient(90deg,#94f7d6 10%,#ffbaf0 100%);box-shadow:0 4px 13px #ffc4ef61}#playingVideo{display:flex;justify-content:center;align-items:center;margin-bottom:28px;min-height:360px;padding:24px 0;background:linear-gradient(135deg,#ffe9fc 0%,#c4edfa 100%);border-radius:30px;box-shadow:0 8px 36px #dbb2ee2f,0 2px 6px #ffdafb46}#playingVideo iframe,#playingVideo .yt,#playingVideo .local-player{aspect-ratio:16/9;width:80vw;max-width:800px;min-width:320px;height:auto;border-radius:21px;background:#000;box-shadow:0 8px 26px #d1c4e990}#playlistItems{list-style:none;padding:20px 0 12px 0;margin:0;background:linear-gradient(96deg,#e7faff 60%,#fff6fa 100%);border:1.8px solid #dde6ef;border-radius:26px;box-shadow:0 2px 16px #e8eafd2f}.playlist-item{border:2.5px solid #f5a6ed;background:linear-gradient(95deg,#ffe0f6 60%,#e8fff8 120%);border-radius:22px;margin:18px 0 24px 0;box-shadow:0 6px 22px #edc9ff36,0 1px 7px #70e6ff12;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:stretch;padding:18px 20px 18px 20px;font-size:1.06rem;text-align:left;transition:background 0.3s;position:relative}.playlist-item.active{border:3.3px solid #67d7ff;background:linear-gradient(93deg,#fff7e7 50%,#e3ffe6 120%);box-shadow:0 8px 32px #a9e3ff56}.playlist-detail{margin-bottom:6px;display:flex;align-items:center;flex-wrap:wrap;gap:8px}.playlist-actions{position:absolute;bottom:10px;right:18px}.playlist-time{font-size:.99em;margin-bottom:6px}.playlist-actions button{margin-right:0px;border:none;border-radius:10px;padding:7px 17px;font-size:1em;cursor:pointer;font-family:'Kanit','Quicksand',sans-serif;box-shadow:0 2px 7px #e8d1fd29;transition:filter 0.13s,box-shadow 0.17s}.playlist-actions .remove-btn{background:linear-gradient(90deg,#ffbdbd,#ffe7b8 90%);color:#be2727}.playlist-actions button:hover{filter:brightness(0.98);box-shadow:0 3px 12px #efe7fe85}.playlist-actions{min-width:44px}.time-edit,.edit-time,.edit-name,.edit-link{border-radius:10px;padding:7px 11px;margin-right:8px;font-size:1em;transition:0.25s;font-family:'Kanit',sans-serif;background:#fafffc}.edit-time{width:90px}.edit-name{width:160px}.edit-link{width:230px}.input-red{border:2.7px solid #fa5f7c!important;background:#fff1f1}.input-green{border:2.7px solid #27c97b!important;background:#e7ffee}.list-number{background:linear-gradient(135deg,#c7ffe6 60%,#e2ffe6 100%);color:#28a876;border-radius:50%;width:38px;height:38px;display:inline-flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.19em;margin-right:13px;margin-top:1px;box-shadow:0 2px 8px #b3ffd633;border:2.5px solid #3ec694}.song-emoji{font-size:1.4em;margin-right:5px}.volume-control{display:flex;align-items:center;gap:5px;margin-left:10px;min-width:120px}.volume-slider{width:90px;height:2px;accent-color:#7ad7c5}.vol-label{font-size:1em;color:#555}.local-input-btn{background:linear-gradient(90deg,#cbf6ff 20%,#ffe1f7 100%);color:#1463a7;border:1.3px solid #b7edcf;border-radius:8px;padding:7px 15px;font-size:1rem;margin-left:15px}.local-input-btn:hover{background:linear-gradient(90deg,#ffe6f8 20%,#c2eeff 100%);color:#b23c7c}.footer{margin:22px 0 0 0;color:#7b67a1;font-size:1.06em;padding-bottom:15px;letter-spacing:.6px;text-shadow:1px 1px 0 #fbefff,0 1px 0 #fff}@media (max-width:900px){.container{max-width:97vw}.form-section{flex-wrap:wrap}}@media (max-width:700px){#playingVideo iframe{height:230px}#playingVideo .local-player{height:230px}.playlist-detail{flex-direction:column;gap:5px}.edit-link,.edit-name,.edit-time{width:100%}.playlist-item{padding:8px 7px;font-size:0.98em}.list-number{width:28px;height:28px;font-size:0.98em}.main-title{font-size:1.3rem}.form-section{flex-direction:column;gap:5px}.form-row-btns{flex-direction:column;gap:5px}#playlistItems{padding:8px 0}}</style></head><body><div class="container"><div class="app-header"><span class="logo-emoji" style="font-size:2.3rem;">üë®‚Äçüè´</span><span class="main-title">School Time Manager 0.1 (GitHub Edition)<span class="logo-emoji">‚è∞</span></span></div><div class="form-row-btns"><div class="file-btns"><button id="openBtn">üìÇ Open</button><input type="file" id="openFile" accept=".stmplaylist,.json"><button id="saveBtn">üíæ Save</button><button id="localInputBtn" class="local-input-btn">üéµ Input Media</button><input type="file" id="localInputFile" accept="audio/*,video/*" style="display:none;"></div></div><h2 style="margin:24px 0 14px 0;font-size:1.32em;font-weight:600;">üé¨ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</h2><div id="playingVideo"><div class="yt"></div></div><h2 style="margin:28px 0 8px 0;font-size:1.18em;font-weight:600;">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h2><ul id="playlistItems"></ul><div class="footer">¬© Copyright 2025 ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏ú‡∏≠.‡∏£‡∏±‡∏ê‡∏Å‡∏£‡∏ì‡πå ‡∏≠‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ú‡∏≠.‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏•‡πÇ‡∏Ñ‡∏Å‡∏Ç‡∏≤‡∏°‡∏°‡∏¥‡∏ï‡∏£‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 95 ‡∏™‡∏û‡∏õ.‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£<br>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà krootoa@gmail.com ‡∏´‡∏£‡∏∑‡∏≠ Discord <a href="https://discord.gg/sDzaupRAfB" style="color:#4262ea;text-decoration:underline;" target="_blank">https://discord.gg/sDzaupRAfB</a></div></div><script>let player,scheduledPlaylist=[],fieldState=[],playingNow=!1,currentVideoIdx=null,isPaused=!1,base64Data={};document.getElementById("localInputBtn").onclick=()=>{document.getElementById("localInputFile").click()},document.getElementById("localInputFile").addEventListener("change",function(e){const t=e.target.files[0];if(!t)return;const n=t.name.replace(/\.[^.]+$/,""),l=t.name.split(".").pop().toLowerCase(),a=new FileReader;a.onload=function(e){const a=e.target.result,o="local_"+Date.now()+"_"+Math.floor(1e8*Math.random()),i=t.type||(l.startsWith("mp4")?"video/mp4":"");base64Data[o]={name:t.name,mime:i,base64:a.split(",")[1]},scheduledPlaylist.push({url:o,name:n,start:"0.0",end:"",scheduledTimes:[],lastPlayedMinute:"",volume:100,pauseBeforePlay:!1,isLocal:!0,ext:l}),fieldState.push({name:"red",time:"red",link:"red",timeadd:"red"}),saveScheduledPlaylistToLocalStorage(),renderPlaylist(),this.value=""}.bind(this),a.readAsDataURL(t)}),document.getElementById("openBtn").onclick=()=>{document.getElementById("openFile").click()},document.getElementById("openFile").addEventListener("change",function(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){try{processLoadedPlaylist(e.target.result),alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!")}catch(e){alert("‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö")}},n.readAsText(t,"utf-8"),this.value=""});function processLoadedPlaylist(e){const t=JSON.parse(e);t&&Array.isArray(t.playlist)?(scheduledPlaylist=t.playlist,base64Data=t.base64Data||{}):Array.isArray(t)&&(scheduledPlaylist=t,base64Data={}),scheduledPlaylist.forEach(e=>{e.lastPlayedMinute||(e.lastPlayedMinute=""),"number"!=typeof e.volume&&(e.volume=100),"boolean"!=typeof e.pauseBeforePlay&&(e.pauseBeforePlay=!1)}),fieldState=scheduledPlaylist.map(()=>({name:"red",time:"red",link:"red",timeadd:"red"})),saveScheduledPlaylistToLocalStorage(),renderPlaylist()}document.getElementById("saveBtn").onclick=()=>{const e={playlist:scheduledPlaylist,base64Data:base64Data},t=new Date,n=["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];function l(e){return e.toString().padStart(2,"0")}let a=`stm-${l(t.getDate())} ${n[t.getMonth()]} ${t.getFullYear()+543}-${l(t.getHours())}.${l(t.getMinutes())}-‡πÇ‡∏î‡∏¢‡∏ú‡∏≠‡∏£‡∏±‡∏ê‡∏Å‡∏£‡∏ì‡πå`;scheduledPlaylist.length>0&&(a+=`-${scheduledPlaylist.map(e=>e.name).join(",")}`),a+=".stmplaylist";const o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=a,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i)},100)};function saveScheduledPlaylistToLocalStorage(){localStorage.setItem("scheduledPlaylist",JSON.stringify(scheduledPlaylist))}function loadYouTubeAPI(){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e)}function onPlayerStateChange(e){e.data===YT.PlayerState.ENDED&&(playingNow=!1,isPaused=!1)}function onPlayerError(e){let t="‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠",n=!1;101===e.data||150===e.data?(t="‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô",n=!0):2===e.data&&(t="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"),playingNow=!1,isPaused=!1;let l=`<div style="margin:40px auto; color:#e42; font-size:1.2em; padding: 20px;">‚ùå ${t}`;n&&null!==currentVideoIdx&&(l+=`<br><br><a href="${scheduledPlaylist[currentVideoIdx].url}" target="_blank" style="background:#e42; color:white; padding:8px 16px; text-decoration:none; border-radius:8px; font-size:0.9em;">‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ô YouTube</a>`),l+="</div>",document.getElementById("playingVideo").innerHTML=l,renderPlaylist()}function renderPlaylist(){const e=document.getElementById("playlistItems");e.innerHTML="",scheduledPlaylist.forEach((t,n)=>{fieldState[n]||(fieldState[n]={name:"red",time:"red",link:"red",timeadd:"red"});const l=document.createElement("li"),a=currentVideoIdx===n&&playingNow?"active":"";l.className=`playlist-item ${a}`,l.innerHTML=`<div style="flex:1; display:flex; flex-direction:column; height:100%;">\n <div style="display:flex; align-items:center; gap:10px; margin-bottom: 6px;">\n <span class="list-number">${n+1}</span>\n <div class="playlist-detail" style="flex:1;">\n <span class="song-emoji">üéµ</span>\n <input class="edit-name ${"green"===fieldState[n].name?"input-green":"input-red"}" type="text" value="${t.name}" title="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á">\n <button class="save-btn save-name-btn" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á">üíæ</button>\n <input class="edit-link ${"green"===fieldState[n].link?"input-green":"input-red"}" type="text" value="${t.url}" title="‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube/Local/ServerPath">\n <button class="save-btn save-link-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏¥‡∏á‡∏Å‡πå">üîó</button>\n <button class="pause-btn" style="margin-left:12px;background:${t.pauseBeforePlay?"#ff4c4c":"#45e36c"};color:#fff;" title="‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô">‚è∏Ô∏è</button>\n <button class="play-btn" title="‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ" style="margin-left:3px;">‚ñ∂Ô∏è</button>\n <div class="volume-control">\n <span class="vol-label">üîä</span>\n <input type="range" min="0" max="100" step="1" class="volume-slider" value="${t.volume||100}">\n <span class="vol-label vol-num">${t.volume||100}%</span>\n </div>\n </div>\n </div>\n <div class="playlist-time">\n ‚è±Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°: <input class="edit-time start ${"green"===fieldState[n].time?"input-green":"input-red"}" type="text" value="${t.start}" title="‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° ‡πÄ‡∏ä‡πà‡∏ô 0.20">\n | ‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î: <input class="edit-time end ${"green"===fieldState[n].time?"input-green":"input-red"}" type="text" value="${t.end}" title="‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏ä‡πà‡∏ô 4.33">\n <button class="save-btn save-time-btn" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤">‚úÖ</button>\n </div>\n <div>\n <span>üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ:</span>\n ${t.scheduledTimes.map((e,t)=>`<span style="color:#196cff; font-weight:bold;">\n ${e}\n <button class="remove-time" data-vid="${n}" data-time="${t}" style="background: #e3f0fd; color: #2b59b6; border: none; border-radius: 7px; font-size:.97em; margin-left:2px; cursor:pointer;">‚úñÔ∏è</button>\n </span>`).join(" ")}\n <input class="time-edit ${"green"===fieldState[n].timeadd?"input-green":"input-red"}" placeholder="‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (hh:mm)">\n <button class="addtime-btn" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤">‚ûï</button>\n </div>\n </div>\n <div class="playlist-actions">\n <button class="remove-btn" title="‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ">üóëÔ∏è</button>\n </div>`;const i=l.querySelector(".volume-slider"),o=l.querySelector(".vol-num");i.oninput=()=>{t.volume=parseInt(i.value),o.textContent=t.volume+"%",saveScheduledPlaylistToLocalStorage(),currentVideoIdx===n&&setPlayerVolume(t.volume)},l.querySelector(".pause-btn").onclick=()=>{t.pauseBeforePlay=!t.pauseBeforePlay,saveScheduledPlaylistToLocalStorage(),renderPlaylist()},l.querySelector(".play-btn").onclick=()=>playVideo(t,n);const d=l.querySelector(".edit-name");d.oninput=d.onfocus=()=>{fieldState[n].name="red",d.classList.add("input-red"),d.classList.remove("input-green")},d.onkeydown=e=>{"Enter"===e.key&&(l.querySelector(".save-name-btn").click(),e.preventDefault())},l.querySelector(".save-name-btn").onclick=()=>{t.name=d.value,fieldState[n].name="green",saveScheduledPlaylistToLocalStorage(),renderPlaylist()};const r=l.querySelector(".edit-link");r.oninput=r.onfocus=()=>{fieldState[n].link="red",r.classList.add("input-red"),r.classList.remove("input-green")},r.onkeydown=e=>{"Enter"===e.key&&(l.querySelector(".save-link-btn").click(),e.preventDefault())},l.querySelector(".save-link-btn").onclick=()=>{t.url=r.value,fieldState[n].link="green",saveScheduledPlaylistToLocalStorage(),renderPlaylist()};const s=l.querySelector(".edit-time.start"),c=l.querySelector(".edit-time.end");[s,c].forEach(e=>{e.oninput=e.onfocus=()=>{fieldState[n].time="red",s.classList.add("input-red"),s.classList.remove("input-green"),c.classList.add("input-red"),c.classList.remove("input-green")},e.onkeydown=e=>{"Enter"===e.key&&(l.querySelector(".save-time-btn").click(),e.preventDefault())}}),l.querySelector(".save-time-btn").onclick=()=>{t.start=s.value,t.end=c.value,fieldState[n].time="green",saveScheduledPlaylistToLocalStorage(),renderPlaylist()};const m=l.querySelector(".time-edit");m.oninput=m.onfocus=()=>{fieldState[n].timeadd="red",m.classList.add("input-red"),m.classList.remove("input-green")},m.onkeydown=e=>{"Enter"===e.key&&(l.querySelector(".addtime-btn").click(),e.preventDefault())},l.querySelector(".addtime-btn").onclick=()=>{/^\d{2}:\d{2}$/.test(m.value)?(t.scheduledTimes.push(m.value),fieldState[n].timeadd="green",saveScheduledPlaylistToLocalStorage(),renderPlaylist()):alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ß‡∏•‡∏≤ hh:mm")},l.querySelector(".remove-btn").onclick=()=>{scheduledPlaylist.splice(n,1),fieldState.splice(n,1),saveScheduledPlaylistToLocalStorage(),renderPlaylist()},l.querySelectorAll(".remove-time").forEach(e=>{e.onclick=e=>{const t=Number(e.target.getAttribute("data-vid")),n=Number(e.target.getAttribute("data-time"));scheduledPlaylist[t].scheduledTimes.splice(n,1),saveScheduledPlaylistToLocalStorage(),renderPlaylist()}}),e.appendChild(l)})}function setPlayerVolume(e){try{player&&"function"==typeof player.setVolume&&player.setVolume(e)}catch(e){}window.localMediaElem&&(window.localMediaElem.volume=(e||100)/100)}function playVideo(e,t){if(e.pauseBeforePlay)return playingNow=!1,currentVideoIdx=t,isPaused=!0,document.getElementById("playingVideo").innerHTML='<div style="margin:40px auto; color:#e42; font-size:1.3em;">‚è∏Ô∏è ‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô pause<br>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <b>‚è∏Ô∏è</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</div>',void renderPlaylist();const n=getYouTubeVideoId(e.url);if(!e.isLocal&&!n&&!e.isServerFile)return void alert("URL ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");if(playingNow=!0,currentVideoIdx=t,isPaused=!1,e.isServerFile){let l=e.url.split(".").pop().toLowerCase(),a=["mp4","webm","ogg"].includes(l)?"video":"audio",o=e.url,i=convertToSeconds(e.start),d=e.end?convertToSeconds(e.end):null;return document.getElementById("playingVideo").innerHTML=`<${a} class="local-player" id="localMediaElem" controls autoplay src="${o}"></${a}>`,setTimeout(()=>{let l=document.getElementById("localMediaElem");l&&(l.volume=(e.volume||100)/100,window.localMediaElem=l,i&&(l.currentTime=i),d&&(l.ontimeupdate=()=>{l.currentTime>=d&&l.pause()}),l.onended=()=>{playingNow=!1,renderPlaylist()})},100),void renderPlaylist()}if(e.isLocal&&base64Data[e.url]){let n=base64Data[e.url],l=(e.ext||"").toLowerCase(),a=n.mime.startsWith("video")||["mp4","webm","ogg"].includes(l)?"video":"audio",o=convertToSeconds(e.start),i=e.end?convertToSeconds(e.end):null,d=`data:${n.mime};base64,${n.base64}`;return document.getElementById("playingVideo").innerHTML=`<${a} class="local-player" id="localMediaElem" controls autoplay src="${d}"></${a}>`,setTimeout(()=>{let e=document.getElementById("localMediaElem");e&&(e.volume=(n.volume||100)/100,window.localMediaElem=e,o&&(e.currentTime=o),i&&(e.ontimeupdate=()=>{e.currentTime>=i&&e.pause()}),e.onended=()=>{playingNow=!1,renderPlaylist()})},100),void renderPlaylist()}let l=convertToSeconds(e.start),a=convertToSeconds(e.end);document.getElementById("playingVideo").innerHTML='<div class="yt"><div id="ytplayer"></div></div>',setTimeout(()=>{player=new YT.Player("ytplayer",{videoId:n,width:"100%",height:"450",playerVars:{autoplay:1,start:l,end:a,origin:window.location.href,rel:0,showinfo:0},events:{onReady:function(t){setPlayerVolume(e.volume||100)},onStateChange:onPlayerStateChange,onError:onPlayerError}})},100),renderPlaylist()}function convertToSeconds(e){if(!e)return 0;const[t,l]=(e||"0.0").split(".").map(Number);return 60*parseInt(t)+(l?parseInt(l):0)}function getYouTubeVideoId(e){const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|shorts\/|watch\?v=|&v=)([^#&?]{11}).*/);return t&&t[2]?t[2]:null}function checkAndPlayScheduledVideos(){const e=new Date,t=e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0"),l=scheduledPlaylist.map((e,t)=>({...e,idx:t})).filter(e=>e.scheduledTimes.includes(t)&&e.lastPlayedMinute!==t&&!e.pauseBeforePlay);l.length>0&&(playVideo(l[0],l[0].idx),scheduledPlaylist[l[0].idx].lastPlayedMinute=t,saveScheduledPlaylistToLocalStorage())}window.onYouTubeIframeAPIReady=function(){},setInterval(checkAndPlayScheduledVideos,1e3),window.onload=function(){fetch("STM_Backup.stmplaylist").then(e=>{if(!e.ok)throw new Error("Server playlist not found");return e.text()}).then(e=>{console.log("Loaded playlist from server (STM_Backup.stmplaylist)"),processLoadedPlaylist(e)}).catch(e=>{console.log("Could not load server playlist, falling back to LocalStorage.",e);try{let e=localStorage.getItem("scheduledPlaylist");e&&(scheduledPlaylist=JSON.parse(e))}catch(e){}fieldState=scheduledPlaylist.map(()=>({name:"red",time:"red",link:"red",timeadd:"red"})),renderPlaylist()}).finally(()=>{loadYouTubeAPI()})};</script></body></html>
